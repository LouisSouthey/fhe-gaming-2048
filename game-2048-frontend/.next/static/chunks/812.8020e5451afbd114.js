"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{7812:(e,r,t)=>{let n,a,i;t.d(r,{createFhevmInstance:()=>H});var o=t(4827),l=t(6037);let s="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class c{isLoaded(){return u(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!d(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,r)=>{if(document.querySelector('script[src="'.concat(s,'"]'))){u(window,this._trace)||r(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let t=document.createElement("script");t.src=s,t.type="text/javascript",t.async=!0,t.onload=()=>{u(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),r(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(s,", however, the window.relayerSDK object is invalid.")))),e()},t.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),r(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(s)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(t),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function d(e,r){return void 0===e?(null==r||r("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==r||r("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==r||r("RelayerSDKLoader: relayerSDK is not an object"),!1):y(e,"initSDK","function",r)?y(e,"createInstance","function",r)?y(e,"SepoliaConfig","object",r)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==r||r("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==r||r("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==r||r("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==r||r("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function u(e,r){return void 0===e?(null==r||r("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==r||r("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==r||r("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?d(e.relayerSDK):(null==r||r("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function y(e,r,t,n){if(!e||"object"!=typeof e)return!1;if(!(r in e))return null==n||n("RelayerSDKLoader: missing ".concat(String(r),".")),!1;let a=e[r];return null==a?(null==n||n("RelayerSDKLoader: ".concat(String(r)," is null or undefined.")),!1):typeof a===t||(null==n||n("RelayerSDKLoader: ".concat(String(r)," is not a ").concat(t,".")),!1)}let f=(e,r)=>r.some(r=>e instanceof r),w=new WeakMap,p=new WeakMap,h=new WeakMap,b={get(e,r,t){if(e instanceof IDBTransaction){if("done"===r)return w.get(e);if("store"===r)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return S(e[r])},set:(e,r,t)=>(e[r]=t,!0),has:(e,r)=>e instanceof IDBTransaction&&("done"===r||"store"===r)||r in e};function S(e){if(e instanceof IDBRequest){let r=new Promise((r,t)=>{let n=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{r(S(e.result)),n()},i=()=>{t(e.error),n()};e.addEventListener("success",a),e.addEventListener("error",i)});return h.set(r,e),r}if(p.has(e))return p.get(e);let r=function(e){if("function"==typeof e)return(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...r){return e.apply(m(this),r),S(this.request)}:function(...r){return S(e.apply(m(this),r))};return(e instanceof IDBTransaction&&function(e){if(w.has(e))return;let r=new Promise((r,t)=>{let n=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{r(),n()},i=()=>{t(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});w.set(e,r)}(e),f(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,b):e}(e);return r!==e&&(p.set(e,r),h.set(r,e)),r}let m=e=>h.get(e),K=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],v=new Map;function g(e,r){if(!(e instanceof IDBDatabase&&!(r in e)&&"string"==typeof r))return;if(v.get(r))return v.get(r);let t=r.replace(/FromIndex$/,""),n=r!==t,a=D.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||K.includes(t)))return;let i=async function(e,...r){let i=this.transaction(e,a?"readwrite":"readonly"),o=i.store;return n&&(o=o.index(r.shift())),(await Promise.all([o[t](...r),a&&i.done]))[0]};return v.set(r,i),i}b=(e=>({...e,get:(r,t,n)=>g(r,t)||e.get(r,t,n),has:(r,t)=>!!g(r,t)||e.has(r,t)}))(b);let E=["continue","continuePrimaryKey","advance"],I={},L=new WeakMap,P=new WeakMap,R={get(e,r){if(!E.includes(r))return e[r];let t=I[r];return t||(t=I[r]=function(...e){L.set(this,P.get(this)[r](...e))}),t}};async function*_(...e){let r=this;if(r instanceof IDBCursor||(r=await r.openCursor(...e)),!r)return;let t=new Proxy(r,R);for(P.set(t,r),h.set(t,m(r));r;)yield t,r=await (L.get(t)||r.continue()),L.delete(t)}function j(e,r){return r===Symbol.asyncIterator&&f(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===r&&f(e,[IDBIndex,IDBObjectStore])}async function A(){return i||(i=function(e,r,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){let o=indexedDB.open(e,1),l=S(o);return n&&o.addEventListener("upgradeneeded",e=>{n(S(o.result),e.oldVersion,e.newVersion,S(o.transaction),e)}),t&&o.addEventListener("blocked",e=>t(e.oldVersion,e.newVersion,e)),l.then(e=>{i&&e.addEventListener("close",()=>i()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}("fhevm",0,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function k(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function B(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function F(e){let r,t=await A();if(!t)return{publicParams:null};let n=null;try{let r=await t.get("publicKeyStore",e);(null==r?void 0:r.value)&&(k(r.value),n=r.value)}catch(e){}let a=null;try{let r=await t.get("paramsStore",e);(null==r?void 0:r.value)&&(B(r.value),a=r.value)}catch(e){}let i=null==n?void 0:n.publicKey,o=null==n?void 0:n.publicKeyId,l=a?{2048:a}:null;return o&&i&&(r={id:o,data:i}),{...void 0!==r&&{publicKey:r},publicParams:l}}async function C(e,r,t){k(r),B(t);let n=await A();n&&(r&&await n.put("publicKeyStore",{acl:e,value:r}),t&&await n.put("paramsStore",{acl:e,value:t}))}b=(e=>({...e,get:(r,t,n)=>j(r,t)?_:e.get(r,t,n),has:(r,t)=>j(r,t)||e.has(r,t)}))(b);class x extends Error{constructor(e,r,t){super(r,t),this.code=e,this.name="FhevmReactError"}}function M(e,r,t){throw new x(e,r,t?{cause:t}:void 0)}let V=async e=>{if(!u(window,console.log))throw Error("window.relayerSDK is not available");let r=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=r,!r)throw Error("window.relayerSDK.initSDK failed.");return!0};class O extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function N(e){if("string"==typeof e){let r=new l.FR(e);return Number((await r.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function W(e){let r=new l.FR(e);try{return await r.send("web3_clientVersion",[])}catch(r){M("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),r)}finally{r.destroy()}}async function z(e){let r=await W(e);if("string"==typeof r&&r.toLowerCase().includes("hardhat"))try{let r=await T(e);if(!r||"object"!=typeof r||!("ACLAddress"in r&&"string"==typeof r.ACLAddress&&r.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in r&&"string"==typeof r.InputVerifierAddress&&r.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in r&&"string"==typeof r.KMSVerifierAddress&&r.KMSVerifierAddress.startsWith("0x")))return;return r}catch(e){return}}async function T(e){let r=new l.FR(e);try{return await r.send("fhevm_relayer_metadata",[])}catch(r){M("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),r)}finally{r.destroy()}}async function U(e,r){let t=await N(e),n="string"==typeof e?e:void 0,a={31337:"http://localhost:8545",...null!=r?r:{}};return Object.hasOwn(a,t)?(n||(n=a[t]),{isMock:!0,chainId:t,rpcUrl:n}):{isMock:!1,chainId:t,rpcUrl:n}}let H=async e=>{let r=()=>{if(a.aborted)throw new O},n=e=>{i&&i(e)},{signal:a,onStatusChange:i,provider:l,mockChains:s}=e,{isMock:d,rpcUrl:y,chainId:f}=await U(l,s);if(d){let e=await z(y);if(e){n("creating");let a=await Promise.all([t.e(235),t.e(79)]).then(t.bind(t,7079)),i=await a.fhevmMockCreateInstance({rpcUrl:y,chainId:f,metadata:e});return r(),i}}r(),u(window,console.log)||(n("sdk-loading"),await new c({trace:console.log}).load(),r(),n("sdk-loaded")),u(window,console.log)&&!0===window.relayerSDK.__initialized__||(n("sdk-initializing"),await V(),r(),n("sdk-initialized"));let w=window.relayerSDK,p=w.SepoliaConfig.aclContractAddress;if(!function(e){return"string"==typeof e&&!!(0,o.PW)(e)}(p))throw Error("Invalid address: ".concat(p));let h=await F(p);r();let b={...w.SepoliaConfig,network:l,publicKey:h.publicKey,publicParams:h.publicParams};n("creating");let S=await w.createInstance(b);return await C(p,S.getPublicKey(),S.getPublicParams(2048)),r(),S}}}]);