(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{1594:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(5155),s=a(8839),l=a(14),d=a(2115);function n(){let{signer:e,chainId:t,instance:a}=(0,s.U)(),{isReady:n,isWalletConnected:o,getGlobalAverages:c,getTotalStats:i,getPlayers:x,getPlayerStats:m,decryptValue:g}=(0,l.X)({instance:a,signer:e,chainId:t}),[y,u]=(0,d.useState)({avgScore:null,avgMoves:null,totalGames:0,totalPlayers:0}),[h,p]=(0,d.useState)(!1),[b,v]=(0,d.useState)(!1),[f,j]=(0,d.useState)([]),[N,k]=(0,d.useState)(!1),[w,D]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{if(o&&i)try{v(!0);let e=await i();e&&(u(t=>({...t,totalGames:e.totalGames,totalPlayers:e.totalPlayers})),console.log("Total stats loaded:",e))}catch(e){console.error("Failed to fetch total stats:",e)}finally{v(!1)}})()},[o,i]),(0,d.useEffect)(()=>{(async()=>{if(o&&x&&m)try{k(!0);let e=await x(0,50);if(e&&e.length>0){let t=await Promise.all(e.map(async e=>{let t=await m(e);return{address:e,gamesPlayed:(null==t?void 0:t.gamesPlayed)||0,encryptedBestScore:(null==t?void 0:t.bestScore)||null,decryptedBestScore:null}}));j(t),console.log("Players loaded:",t.length)}}catch(e){console.error("Failed to fetch players:",e)}finally{k(!1)}})()},[o,x,m]);let S=async t=>{let a=f.find(e=>e.address===t);if(!a||!a.encryptedBestScore||!g)return void alert("Cannot decrypt this player's score");let r=await (null==e?void 0:e.getAddress());if((null==r?void 0:r.toLowerCase())!==t.toLowerCase())return void alert("You can only decrypt your own score!");D(t);try{console.log("\uD83D\uDD13 Decrypting score for ".concat(t,"..."));let e=await g(a.encryptedBestScore);if(null!==e)j(a=>a.map(a=>a.address===t?{...a,decryptedBestScore:e}:a)),console.log("✅ Decrypted score: ".concat(e));else throw Error("Decryption returned null")}catch(t){let e=t instanceof Error?t.message:"Decryption failed";console.error("❌ Failed to decrypt:",t),alert("Failed to decrypt: ".concat(e))}finally{D(null)}},B=async()=>{if(!c)return void alert("Global averages function not available yet");p(!0);try{let e=await c();e&&u(t=>({...t,avgScore:e.avgScore,avgMoves:e.avgMoves}))}catch(e){console.error("Failed to load global averages:",e),alert("Failed to load global averages. Make sure there are completed games.")}finally{p(!1)}};return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800 p-4 pt-24",children:(0,r.jsxs)("div",{className:"container mx-auto max-w-4xl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center text-teal-600 dark:text-teal-400",children:"Global Leaderboard"}),o?(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[(0,r.jsxs)("div",{className:"glass rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2 text-gray-600 dark:text-gray-400",children:"Total Games Played"}),b?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-gray-500",children:"Loading..."})]}):(0,r.jsx)("div",{className:"text-4xl font-bold text-teal-600 dark:text-teal-400",children:y.totalGames})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2 text-gray-600 dark:text-gray-400",children:"Total Players"}),b?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-gray-500",children:"Loading..."})]}):(0,r.jsx)("div",{className:"text-4xl font-bold text-cyan-600 dark:text-cyan-400",children:y.totalPlayers})]})]}):(0,r.jsx)("div",{className:"glass rounded-xl p-8 text-center mb-8",children:(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"⚠️ Connect your wallet to view global statistics"})}),(0,r.jsxs)("div",{className:"glass rounded-xl p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200",children:"\uD83D\uDD12 Encrypted Global Averages"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Average Score"}),null!==y.avgScore?(0,r.jsx)("div",{className:"text-3xl font-bold text-teal-600 dark:text-teal-400",children:y.avgScore}):(0,r.jsx)("div",{className:"text-gray-400 dark:text-gray-500",children:"Not loaded"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Average Moves"}),null!==y.avgMoves?(0,r.jsx)("div",{className:"text-3xl font-bold text-cyan-600 dark:text-cyan-400",children:y.avgMoves}):(0,r.jsx)("div",{className:"text-gray-400 dark:text-gray-500",children:"Not loaded"})]})]}),n&&(0,r.jsx)("button",{onClick:B,disabled:h,className:"w-full px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white rounded-lg hover:shadow-lg transition-all disabled:opacity-50 font-semibold",children:h?"Loading & Decrypting...":"Load Global Averages"}),!n&&(0,r.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"⚠️ Connect your wallet to view global averages"})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-6 bg-teal-50/50 dark:bg-teal-900/20 border border-teal-200 dark:border-teal-800 mb-8",children:[(0,r.jsx)("h3",{className:"font-semibold text-teal-800 dark:text-teal-200 mb-2",children:"\uD83D\uDD12 How Privacy Works"}),(0,r.jsxs)("ul",{className:"text-sm text-teal-700 dark:text-teal-300 space-y-2",children:[(0,r.jsx)("li",{children:"• Individual scores are encrypted on-chain using FHEVM"}),(0,r.jsx)("li",{children:"• Only you can decrypt your own scores"}),(0,r.jsx)("li",{children:"• Global averages are computed on encrypted data"}),(0,r.jsx)("li",{children:"• No individual scores are revealed in the process"}),(0,r.jsx)("li",{children:"• This demonstrates privacy-preserving aggregate analytics"})]})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:"All Players"}),f.length>0&&(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[f.length," ",1===f.length?"player":"players"]})]}),(0,r.jsx)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,r.jsx)("strong",{children:"\uD83D\uDD12 Privacy Note:"})," All scores are encrypted on-chain. You can only decrypt your own score. Ranking encrypted data is not possible without revealing the plaintext values."]})}),N?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading players..."})]}):f.length>0?(0,r.jsx)("div",{className:"space-y-3",children:f.map((t,a)=>{null==e||e.getAddress().then(e=>e.toLowerCase()===t.address.toLowerCase());let s=w===t.address;return(0,r.jsx)("div",{className:"p-4 bg-white/50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:a+1}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"font-mono text-sm text-gray-700 dark:text-gray-300 break-all",children:[t.address.slice(0,6),"...",t.address.slice(-4)]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[t.gamesPlayed," ",1===t.gamesPlayed?"game":"games"," played"]})]})]}),t.encryptedBestScore&&t.encryptedBestScore>BigInt(0)?null!==t.decryptedBestScore?(0,r.jsxs)("div",{className:"mt-3 p-3 bg-teal-50 dark:bg-teal-900/20 rounded-lg border border-teal-200 dark:border-teal-800",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Best Score"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-teal-600 dark:text-teal-400",children:t.decryptedBestScore})]}):(0,r.jsxs)("div",{className:"mt-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[(0,r.jsx)("div",{className:"text-xs text-purple-700 dark:text-purple-300 mb-1",children:"\uD83D\uDD12 Best Score (Encrypted)"}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono break-all",children:[t.encryptedBestScore.toString().slice(0,20),"..."]})]}):(0,r.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:"No completed games yet"})]}),t.encryptedBestScore&&t.encryptedBestScore>BigInt(0)&&null===t.decryptedBestScore&&(0,r.jsx)("button",{onClick:()=>S(t.address),disabled:s||!n,className:"px-4 py-2 bg-gradient-to-r from-teal-500 to-cyan-500 text-white rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium whitespace-nowrap",children:s?(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"inline-block w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Decrypting..."]}):"\uD83D\uDD13 Decrypt"})]})},t.address)})}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFAE"}),(0,r.jsx)("div",{className:"text-gray-500 dark:text-gray-400 mb-2",children:"No players yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Be the first to play and submit a score!"})]})]})]})})}},3066:(e,t,a)=>{Promise.resolve().then(a.bind(a,1594))},5378:(e,t,a)=>{"use strict";a.d(t,{_:()=>s});var r=a(6994);function s(e,t,a){var s=(0,r._)(e,t,"set");if(s.set)s.set.call(e,a);else{if(!s.writable)throw TypeError("attempted to set read only private field");s.value=a}return a}},5777:(e,t,a)=>{"use strict";function r(e,t,a){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object");t.set(e,a)}a.d(t,{_:()=>r})},6994:(e,t,a)=>{"use strict";function r(e,t,a){if(!t.has(e))throw TypeError("attempted to "+a+" private field on non-instance");return t.get(e)}a.d(t,{_:()=>r})},7325:(e,t,a)=>{"use strict";a.d(t,{_:()=>s});var r=a(6994);function s(e,t){var a=(0,r._)(e,t,"get");return a.get?a.get.call(e):a.value}}},e=>{e.O(0,[12,456,441,255,358],()=>e(e.s=3066)),_N_E=e.O()}]);